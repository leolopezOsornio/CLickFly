"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[4238],{4238:(x,v,i)=>{i.r(v),i.d(v,{AddCorreoPageModule:()=>U});var p=i(177),c=i(4341),s=i(4742),C=i(786),m=i(467),y=i(7464);const b=(0,y.F3)("Geolocation",{web:()=>i.e(2920).then(i.bind(i,2920)).then(t=>new t.GeolocationWeb)});!function A(t=!1){window.CapacitorUtils=window.CapacitorUtils||{},void 0===window.Capacitor||t?void 0!==window.cordova&&function S(t){t.CapacitorUtils.Synapse=new Proxy({},{get:(l,a)=>t.cordova.plugins[a]})}(window):function P(t){t.CapacitorUtils.Synapse=new Proxy({},{get:(l,a)=>new Proxy({},{get:(o,r)=>(n,g,f)=>{const u=t.Capacitor.Plugins[a];void 0!==u?"function"==typeof u[r]?(0,m.A)(function*(){try{const d=yield u[r](n);g(d)}catch(d){f(d)}})():f(new Error(`Method ${r} not found in Capacitor plugin ${a}`)):f(new Error(`Capacitor plugin ${a} not found`))}})})}(window)}();var h=i(7691),e=i(4438),F=i(4303),w=i(3656);function G(t,l){if(1&t&&(e.j41(0,"div"),e.nrm(1,"img",11),e.k0s()),2&t){const a=e.XpG();e.R7$(),e.Y8G("src",a.imagenUrl,e.B4B)}}const E=[{path:"",component:(()=>{var t;class l{constructor(o,r,n,g,f,u,d){this.fb=o,this.authService=r,this.toastController=n,this.router=g,this.navCtrl=f,this.actionSheetController=u,this.loadingController=d,this.isLoading=!1,this.imagenUrl=null,this.imagenBase64=null,this.isLargeScreen=!1,this.correoForm=this.fb.group({correo:["",[c.k0.required,c.k0.email]],nombre:["",c.k0.required],nota:["",c.k0.required],imagen:[""]})}updateScreenSize(){this.isLargeScreen=window.innerWidth>=765}ngOnInit(){const o=JSON.parse(localStorage.getItem("usuario")||"null"),r=localStorage.getItem("authToken");o&&r||this.navCtrl.navigateBack("/home")}enviarFormulario(){var o=this;return(0,m.A)(function*(){if(o.correoForm.invalid)return void o.authService.mostrarToast("Por favor, completa todos los campos correctamente","warning");const r=yield o.loadingController.create({message:"Guardando...",spinner:"crescent"});yield r.present();try{const{latitude:n,longitude:g}=yield o.getLocation();if(!n||!g)return yield r.dismiss(),void o.authService.mostrarToast("No se pudo obtener la ubicaci\xf3n","danger");const f={...o.correoForm.value,latitud:n,longitud:g};o.authService.insertarCorreo(f).subscribe({next:(u=(0,m.A)(function*(d){o.authService.mostrarToast(d.message,"success"),o.correoForm.reset(),o.router.navigate(["/inicio"]),yield r.dismiss()}),function(j){return u.apply(this,arguments)}),error:function(){var u=(0,m.A)(function*(d){o.authService.mostrarToast(d.error.message||"Error al guardar","danger"),yield r.dismiss()});return function(j){return u.apply(this,arguments)}}()})}catch(n){o.authService.mostrarToast("No se pudo obtener la ubicaci\xf3n","danger"),console.error("Error obteniendo ubicaci\xf3n:",n),yield r.dismiss()}var u})()}seleccionarImagen(){var o=this;return(0,m.A)(function*(){yield(yield o.actionSheetController.create({header:"Seleccionar imagen",buttons:[{text:"Tomar una foto",icon:"camera",handler:()=>o.obtenerImagen(h.ru.Camera)},{text:"Elegir de la galer\xeda",icon:"image",handler:()=>o.obtenerImagen(h.ru.Photos)},{text:"Cancelar",icon:"close",role:"cancel"}]})).present()})()}obtenerImagen(o){var r=this;return(0,m.A)(function*(){try{const n=yield h.i7.getPhoto({quality:90,allowEditing:!1,resultType:h.LK.Base64,source:o});n.base64String&&(r.imagenBase64=n.base64String,r.imagenUrl=`data:image/jpeg;base64,${n.base64String}`,r.correoForm.patchValue({imagen:r.imagenBase64}))}catch(n){r.authService.mostrarToast("No se pudo seleccionar la imagen","danger"),console.error("Error al seleccionar imagen:",n)}})()}getLocation(){return(0,m.A)(function*(){if(!y.Ii.isNativePlatform())return new Promise((o,r)=>{navigator.geolocation?navigator.geolocation.getCurrentPosition(n=>{o({latitude:n.coords.latitude,longitude:n.coords.longitude})},n=>{console.error("Error obteniendo la ubicaci\xf3n:",n),o({latitude:0,longitude:0})},{enableHighAccuracy:!0,timeout:1e4}):(console.error("Geolocalizaci\xf3n no soportada por el navegador."),o({latitude:0,longitude:0}))});try{if("granted"===(yield b.requestPermissions()).location){const r=yield b.getCurrentPosition({enableHighAccuracy:!0});return{latitude:r.coords.latitude,longitude:r.coords.longitude}}return console.error("Permisos de geolocalizaci\xf3n denegados."),{latitude:0,longitude:0}}catch(o){return console.error("Error obteniendo la ubicaci\xf3n:",o),{latitude:0,longitude:0}}})()}}return(t=l).\u0275fac=function(o){return new(o||t)(e.rXU(c.ok),e.rXU(F.u),e.rXU(s.K_),e.rXU(C.Ix),e.rXU(w.q9),e.rXU(s.GD),e.rXU(s.Xi))},t.\u0275cmp=e.VBU({type:t,selectors:[["app-add-correo"]],hostBindings:function(o,r){1&o&&e.bIt("resize",function(g){return r.updateScreenSize(g)},!1,e.tSv)},standalone:!1,decls:27,vars:5,consts:[[3,"translucent"],[1,"form-container"],[3,"ngClass"],[3,"ngSubmit","formGroup"],["position","floating"],["formControlName","correo","type","email"],["formControlName","nombre","type","text"],["formControlName","nota"],["button","",3,"click"],[4,"ngIf"],["expand","full","type","submit",1,"insertar_correo",3,"disabled"],["alt","Vista previa",1,"imagen-previa",3,"src"]],template:function(o,r){1&o&&(e.j41(0,"ion-header",0),e.nrm(1,"ion-toolbar"),e.k0s(),e.j41(2,"ion-content")(3,"main",1)(4,"h2",2),e.EFF(5,"\u{1f4e9} "),e.j41(6,"strong"),e.EFF(7,"Agregar correo"),e.k0s()(),e.j41(8,"form",3),e.bIt("ngSubmit",function(){return r.enviarFormulario()}),e.j41(9,"ion-item")(10,"ion-label",4),e.EFF(11,"Correo"),e.k0s(),e.nrm(12,"ion-input",5),e.k0s(),e.j41(13,"ion-item")(14,"ion-label",4),e.EFF(15,"Nombre"),e.k0s(),e.nrm(16,"ion-input",6),e.k0s(),e.j41(17,"ion-item")(18,"ion-label",4),e.EFF(19,"Nota"),e.k0s(),e.nrm(20,"ion-textarea",7),e.k0s(),e.j41(21,"ion-item",8),e.bIt("click",function(){return r.seleccionarImagen()}),e.j41(22,"ion-label"),e.EFF(23,"\u{1f4f7} Seleccionar Imagen"),e.k0s()(),e.DNE(24,G,2,1,"div",9),e.j41(25,"ion-button",10),e.EFF(26," Guardar Correo "),e.k0s()()()()),2&o&&(e.Y8G("translucent",!0),e.R7$(4),e.Y8G("ngClass",r.isLargeScreen?"":"espacio_css"),e.R7$(4),e.Y8G("formGroup",r.correoForm),e.R7$(16),e.Y8G("ngIf",r.imagenUrl),e.R7$(),e.Y8G("disabled",r.correoForm.invalid))},dependencies:[p.YU,p.bT,c.qT,c.BC,c.cb,s.Jm,s.W9,s.eU,s.$w,s.uz,s.he,s.nc,s.ai,s.Gw,c.j4,c.JD],styles:[".insertar_correo[_ngcontent-%COMP%]{--background: #4b911c !important;--color: #fff;margin-left:8px;font-size:10px}.form-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;width:100%;max-width:50rem;margin:0 auto;padding:0}form[_ngcontent-%COMP%]{width:100%;display:flex;flex-direction:column}ion-item[_ngcontent-%COMP%]{width:100%}.imagen-previa[_ngcontent-%COMP%]{width:30%;height:auto}"]}),l})()}];let I=(()=>{var t;class l{}return(t=l).\u0275fac=function(o){return new(o||t)},t.\u0275mod=e.$C({type:t}),t.\u0275inj=e.G2t({imports:[C.iI.forChild(E),C.iI]}),l})(),U=(()=>{var t;class l{}return(t=l).\u0275fac=function(o){return new(o||t)},t.\u0275mod=e.$C({type:t}),t.\u0275inj=e.G2t({imports:[p.MD,c.YN,s.bv,c.X1,I]}),l})()}}]);